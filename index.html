<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans&family=Noto+Sans+Display:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <link href="css/style.css" rel="stylesheet" />
    <title>OECD Better Life Index</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="js/script.js"></script>
    <script src="js/petal.js"></script>
    <script src="js/updateVis.js"></script>
  </head>
  <body>
    <div class="viz">
      <div class="container box box1">
        <h3>Create your Better Life Index</h3>
        <p>Adjust the sliders to assign a weight (0-10) to each dimension:</p>

        <!-- Sliders for the 11 Dimensions -->
        <div id="sliders">
          <div class="dimension">
            <div class="label-container">
              <img src="img/Housing.png" alt="Housing" class="dimension-icon" />
              <label for="housing">Housing</label>
              <span id="housingValue">5</span>
            </div>
            <input
              type="range"
              id="housing"
              name="housing"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img src="img/Income.png" alt="Income" class="dimension-icon" />
              <label for="income">Income</label>
              <span id="incomeValue">5</span>
            </div>
            <input
              type="range"
              id="income"
              name="income"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img src="img/Jobs.png" alt="Jobs" class="dimension-icon" />
              <label for="jobs">Jobs</label>
              <span id="jobsValue">5</span>
            </div>
            <input
              type="range"
              id="jobs"
              name="jobs"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img
                src="img/Community.png"
                alt="Community"
                class="dimension-icon"
              />
              <label for="community">Community</label>
              <span id="communityValue">5</span>
            </div>
            <input
              type="range"
              id="community"
              name="community"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img
                src="img/Education.png"
                alt="Education"
                class="dimension-icon"
              />
              <label for="education">Education</label>
              <span id="educationValue">5</span>
            </div>
            <input
              type="range"
              id="education"
              name="education"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img
                src="img/Environment.png"
                alt="Environment"
                class="dimension-icon"
              />
              <label for="environment">Environment</label>
              <span id="environmentValue">5</span>
            </div>
            <input
              type="range"
              id="environment"
              name="environment"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img
                src="img/CivicEngagement.png"
                alt="Civic Engagement"
                class="dimension-icon"
              />
              <label for="civic">Civic Engagement</label>
              <span id="civicValue">5</span>
            </div>
            <input
              type="range"
              id="civic"
              name="civic"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img src="img/Health.png" alt="Health" class="dimension-icon" />
              <label for="health">Health</label>
              <span id="healthValue">5</span>
            </div>
            <input
              type="range"
              id="health"
              name="health"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img
                src="img/LifeSatisfaction.png"
                alt="Life Satisfaction"
                class="dimension-icon"
              />
              <label for="satisfaction">Life Satisfaction</label>
              <span id="satisfactionValue">5</span>
            </div>
            <input
              type="range"
              id="satisfaction"
              name="satisfaction"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img src="img/Safety.png" alt="Safety" class="dimension-icon" />
              <label for="safety">Safety</label>
              <span id="safetyValue">5</span>
            </div>
            <input
              type="range"
              id="safety"
              name="safety"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
          <div class="dimension">
            <div class="label-container">
              <img
                src="img/WorkLifeBalance.png"
                alt="Work Life Balance"
                class="dimension-icon"
              />
              <label for="balance">Work-Life Balance</label>
              <span id="balanceValue">5</span>
            </div>
            <input
              type="range"
              id="balance"
              name="balance"
              min="0"
              max="10"
              step="1"
              class="slider"
              value="5"
            />
          </div>
        </div>
        <div
          id="sorting-controls"
          style="margin-top: 20px; margin-bottom: 20px"
        >
          <label for="sort-select" style="margin-right: 10px"
            >Sort countries by:
          </label>
          <select id="sort-select">
            <option value="default">Default (Original Order)</option>
            <option value="performance_desc">
              Performance (Highest First)
            </option>
            <option value="performance_asc">Performance (Lowest First)</option>
            <option value="alphabetical_asc">Name (A-Z)</option>
            <option value="alphabetical_desc">Name (Z-A)</option>
          </select>
        </div>
      </div>

      <div id="flower-container" class="box box2"></div>
    </div>
    <div
      id="tooltip"
      style="opacity: 0; position: absolute; pointer-events: none"
    >
      <p style="margin: 0 0 5px 0">
        <strong id="tooltip-country-name"></strong>
      </p>
      <div id="tooltip-barchart-container"></div>
    </div>
    <script>
      const dimensions = [
        "housing",
        "income",
        "jobs",
        "community",
        "education",
        "environment",
        "civic",
        "health",
        "satisfaction",
        "safety",
        "balance",
      ];

      const weights = {};

      let sumOfUserWeights = 0;

      // Initialize default weights and update display
      dimensions.forEach((dimension) => {
        const slider = document.getElementById(dimension);
        const valueDisplay = document.getElementById(`${dimension}Value`);
        weights[dimension] = slider.value;

        slider.addEventListener("input", () => {
          weights[dimension] = slider.value;
          valueDisplay.textContent = slider.value;
          //updateWeightsList();
          updateVis();
        });
      });

      /* function updateWeightsList() {
        const list = document.getElementById("weightsList");
        list.innerHTML = dimensions
          .map((d) => `<li>${d.replace("-", " ")}: ${weights[d]}</li>`)
          .join("");
      }*/

      // Initial render
      //updateWeightsList();

      // https://jsfiddle.net/NovasTaylor/f91ujcfp/

      // Sample data, replace with actual data
      const dimensionsNum = 11;

      // weight
      var weight = [
        { dim: "housing", value: 1, cumul: 1 },
        { dim: "income", value: 1, cumul: 2 },
        { dim: "jobs", value: 1, cumul: 3 },
        { dim: "community", value: 1, cumul: 4 },
        { dim: "education", value: 1, cumul: 5 },
        { dim: "environment", value: 1, cumul: 6 },
        { dim: "civic", value: 1, cumul: 7 },
        { dim: "health", value: 1, cumul: 8 },
        { dim: "satisfaction", value: 1, cumul: 9 },
        { dim: "safety", value: 1, cumul: 10 },
        { dim: "balance", value: 1, cumul: 11 },
      ];

      // var totalWeight = 11;

      var weightPetal = 1;
      var totalWeight = 11;

      /*   const scores = [
              {
                country: "Australia",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia2",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria2",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium2",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada2",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia3",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria=3",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium3",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada3",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia4",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria4",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium4",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada4",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia5",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria5",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium5",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada5",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia6",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria6",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium6",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada6",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia7",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria7",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium7",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada7",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia8",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria8",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium8",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada8",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia9",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria9",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium9",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada9",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Australia10",
                data: [
                  { dim: "housing", value: 10 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 3 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 8 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Austria10",
                data: [
                  { dim: "housing", value: 1 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 3 },
                  { dim: "community", value: 2 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 8 },
                  { dim: "health", value: 4 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 7 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Belgium10",
                data: [
                  { dim: "housing", value: 0 },
                  { dim: "income", value: 1 },
                  { dim: "jobs", value: 0 },
                  { dim: "community", value: 1 },
                  { dim: "education", value: 1 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 1 },
                  { dim: "health", value: 1 },
                  { dim: "satisfaction", value: 0 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
              {
                country: "Canada10",
                data: [
                  { dim: "housing", value: 6 },
                  { dim: "income", value: 5 },
                  { dim: "jobs", value: 1 },
                  { dim: "community", value: 3 },
                  { dim: "education", value: 6 },
                  { dim: "environment", value: 2 },
                  { dim: "civic", value: 5 },
                  { dim: "health", value: 7 },
                  { dim: "satisfaction", value: 2 },
                  { dim: "safety", value: 0 },
                  { dim: "balance", value: 1 },
                ],
              },
            ];
      */
      let scores = [];
      d3.tsv("data.tsv").then(function (loadedData) {
        // 1. Process the loaded TSV data
        scores = loadedData.map((row) => {
          const countryData = {
            country: row.country, // Assuming a 'country' column in your TSV
            data: dimensions.map((dimName) => ({
              dim: dimName,
              value: +row[dimName], // Convert score to number, ensure TSV headers match dimName
            })),
          };
          return countryData;
        });

        if (!scores || scores.length === 0) {
          console.error(
            "No data loaded or data is empty. Check data.tsv path and format."
          );
          // Display a message to the user in the flower-container
          document.getElementById("flower-container").innerHTML =
            "<p style='color:red; text-align:center;'>Error: Could not load or process visualization data. Please ensure 'data.tsv' is present and correctly formatted.</p>";
          return;
        }
        initialize();
      });

      // Set up SVG container
      const svgWidth = document.getElementById("flower-container").offsetWidth; //getWidth();
      const svgHeight = getHeight();
      const marginText = 125;
      const margin = 50;
      const svg = d3
        .select("#flower-container")
        .append("svg")
        .attr("width", svgWidth)
        .attr("height", svgHeight - 2 * margin);

      //Container for the gradients
      var defs = svg.append("defs");

      //Filter for the outside glow
      var filter = defs.append("filter").attr("id", "glow");
      filter
        .append("feGaussianBlur")
        .attr("stdDeviation", "8")
        .attr("result", "coloredBlur");
      var feMerge = filter.append("feMerge");
      feMerge.append("feMergeNode").attr("in", "coloredBlur");
      feMerge.append("feMergeNode").attr("in", "SourceGraphic");

      //initialize  all variables;
      let radiusScale;
      let petalWeightScale;
      let opacityScale;
      let colorScale;
      let pie;
      let angleScale;
      let flowerHeight;
      let flowers;

      function initialize() {
        // Define scale for petal
        radiusScale = d3
          .scaleLinear()
          .domain([0, 10])
          .range([0, svgWidth / (0.75 * scores.length)]);

        //  Define scale for petal width
        petalWeightScale = d3.scaleLinear().domain([0, 10]).range([3, 10]);

        // Define scale for opacity
        opacityScale = d3
          .scaleLinear()
          .domain([0, 0.06, 0.09, 1])
          .range([0.25, 0.3, 0.75, 1]);

        // Define color scale
        colorScale = d3
          .scaleOrdinal()
          .domain([
            "housing",
            "income",
            "jobs",
            "community",
            "education",
            "environment",
            "civic",
            "health",
            "satisfaction",
            "safety",
            "balance",
          ])
          .range([
            "#33a594",
            "#197ebf",
            "#1ea2e2",
            "#db4c60",
            "#7fad3e",
            "#21a554",
            "#deaa00",
            "#7e3874",
            "#e5632f",
            "#606060",
            "#992825",
          ]);

        // Prepare data for flowers
        pie = d3
          .pie()
          .sort(null)
          .value(function (d) {
            return d.value;
          });

        // Define x position for flower
        angleScale = d3
          .scaleBand()
          .domain(scores.map((d) => d.country))
          .range([0 + margin, svgWidth - margin])
          .padding(0.1);

        // Define height for flower
        flowerHeight = d3
          .scaleLinear()
          .domain([0, 10])
          .range([svgHeight - marginText, 0]);

        // --- Create Y-Axis Group Element (ONCE) ---
        yAxisGroup = svg
          .append("g")
          .attr("class", "y-axis")
          .attr("transform", `translate(${margin / 2}, 0)`); // Position at the left margin

        // Dynamic scale implementation
        updateDynamicFlowerHeightDomain(); // Set initial dynamic domain
        drawOrUpdateYAxis(0); // Draw the Y-axis for the first time (no transition)

        // Create flowers
        flowers = svg
          .selectAll(".flower")
          .data(scores)
          .enter()
          .append("g")
          .attr("class", "flower")
          .attr("id", (d) => d.country + "Flower")
          .attr("transform", function (d) {
            return `translate(${angleScale(
              d.country
            )}, ${flowerHeight(calculateMean(d.data))})`;
          });
        //add  background circle for mouseover
        flowers
          .append("circle")
          .attr("class", "shadow")
          .attr("id", (d) => d.country + "FlowerShadow")
          .attr("cx", "0")
          .attr("cy", "0")
          .attr("r", svgWidth / scores.length / 3)
          .attr("fill", "rgba(255,255,255,0.1)")
          .style("filter", "url(#glow)");
        //.style("opacity", 1);

        // add flower stem
        flowers
          .append("line")
          .attr("class", "stem")
          .attr("x1", 0)
          .attr("x2", 0)
          .attr("y1", 0)
          .attr("y2", function (d) {
            return flowerHeight(calculateMean(d.data)) + marginText;
          })
          .attr("stroke", "#46AEA7");

        // add flowers petals
        flowers
          .selectAll(".petal")
          .data((d, i) => pie(scores[i].data))
          .enter()
          .append("path")
          .attr("class", "petal")
          .attr("transform", function (d, i) {
            return r(
              (weight[i].cumul * 2 * Math.PI) / weight[dimensionsNum - 1].cumul
            );
          })
          // .attr("d", petalPath)
          .style("stroke", petalStroke)
          .style("fill", petalFill);

        // add country name to flower
        flowers
          .append("text")
          .attr("class", "countryName")
          .attr("x", 0)
          .attr("y", 0)
          .attr("text-anchor", "end")
          .attr("transform", (d, i) => {
            return "translate( " + 3 + " , " + 10 + ")," + "rotate(-90)";
          })
          .text(function (d) {
            return d.country;
          });

        flowers.on("mouseover", function () {
          d3.selectAll(".flower").style("opacity", 0.25);
          d3.select(this).style("opacity", 1);
        });
        flowers.on("mouseout", function () {
          d3.selectAll(".flower").style("opacity", 1);
          d3.select(this).style("opacity", 1);
        });
        updateVis();

        const tooltipDiv = d3.select("#tooltip");
        const tooltipCountryName = d3.select("#tooltip-country-name");
        const tooltipBarChartContainer = d3.select(
          "#tooltip-barchart-container"
        );

        // Tooltip Bar Chart Dimensions
        const tipMargin = { top: 15, right: 15, bottom: 15, left: 55 };
        const tipWidth = 200 - tipMargin.left - tipMargin.right; // Adjust 200 if tooltip min-width changes
        const tipHeight = 250 - tipMargin.top - tipMargin.bottom;

        // Append SVG for the tooltip bar chart (only once)
        const tipSvg = tooltipBarChartContainer
          .append("svg")
          .attr("width", tipWidth + tipMargin.left + tipMargin.right)
          .attr("height", tipHeight + tipMargin.top + tipMargin.bottom)
          .append("g")
          .attr("transform", `translate(${tipMargin.left},${tipMargin.top})`);

        // X Scale for tooltip bar chart (uses global 'dimensions' array)
        const tipYScale = d3
          .scaleBand()
          .domain(dimensions)
          .range([0, tipHeight])
          .padding(0.25); // Inverted for SVG y-coordinate

        // Y Scale for tooltip bar chart (scores 0-10)
        const tipXScale = d3
          .scaleLinear()
          .domain([0, 10]) // Assuming scores are always 0-10 for dimensions
          .range([0, tipWidth]);

        // Add Y Axis to tooltip SVG
        tipSvg
          .append("g")
          .attr("class", "axis tooltip-y-axis")
          .attr("transform", `translate(0,0})`)
          .call(d3.axisLeft(tipYScale))
          .selectAll("text")
          .attr("class", "tooltip-y-axis-label")
          .attr("y", 0)
          .attr("x", -5)
          .attr("dy", ".35em")
          //.attr("transform", "rotate(-60)")
          .style("text-anchor", "end")
          .style("font-size", "8px")
          //.text((d) => d.substring(0, 3).toUpperCase()); // Abbreviate e.g., "HOU"
          .text((d) => d); // Abbreviate e.g., "HOU"

        // Add Y Axis to tooltip SVG
        tipSvg
          .append("g")
          .attr("class", "axis tooltip-x-axis")
          .call(d3.axisTop(tipXScale).ticks(5).tickFormat(d3.format(".0f")));

        // Attach Event Listeners to Flowers
        // 'flowers' is your D3 selection of all <g class="flower"> elements.
        // Ensure this 'flowers' variable is the one created by .enter().append("g")
        if (flowers && typeof flowers.on === "function") {
          flowers
            .on("mouseover.tooltip", function (d) {
              // For D3 v5, 'd' is the datum. d3.event for mouse coords.
              tooltipDiv.style("opacity", 0.95);
              tooltipCountryName.text(d.country);

              const bars = tipSvg
                .selectAll(".tooltip-bar")
                .data(d.data, (dataPoint) => dataPoint.dim);

              bars
                .enter()
                .append("rect")
                .attr("class", "tooltip-bar")
                .attr("y", (dataPoint) => tipYScale(dataPoint.dim))
                .attr("width", 0) // Start with no height for animation
                .attr("x", 0) // Start from bottom for animation
                .attr("height", tipYScale.bandwidth())
                .style("fill", (dataPoint) => colorScale(dataPoint.dim)) // Uses global colorScale
                .merge(bars)
                .transition()
                .duration(200)
                .attr("y", (dataPoint) => tipYScale(dataPoint.dim))
                .attr("height", tipYScale.bandwidth())
                .attr("x", 0)
                .attr("width", (dataPoint) => tipXScale(dataPoint.value))
                .style("fill", (dataPoint) => colorScale(dataPoint.dim));

              bars
                .exit()
                .transition()
                .duration(100)
                .attr("y", tipHeight)
                .attr("height", 0)
                .remove();
            })
            .on("mousemove.tooltip", function () {
              const event = d3.event; // Get the current event

              // Get tooltip dimensions. It's important to do this after it's visible and content is set.
              const tooltipNode = tooltipDiv.node();
              const tooltipWidth = tooltipNode.offsetWidth;
              const tooltipHeight = tooltipNode.offsetHeight;

              // Get window dimensions
              const viewportWidth = window.innerWidth;
              const viewportHeight = window.innerHeight;
              const scrollX = window.scrollX || window.pageXOffset; // For pages wider than viewport
              const scrollY = window.scrollY || window.pageYOffset; // For pages taller than viewport

              // Define preferred offsets from the cursor
              let offsetX = 15;
              let offsetY = -30; // Typically above and to the right

              // Calculate initial proposed position
              let xPosition = event.pageX + offsetX;
              let yPosition = event.pageY + offsetY;

              // --- Boundary checks and adjustments ---
              const safetyMargin = 10; // Small margin from window edges

              // Check right boundary
              if (
                xPosition + tooltipWidth + safetyMargin >
                viewportWidth + scrollX
              ) {
                xPosition = event.pageX - tooltipWidth - offsetX; // Flip to the left of cursor
              }
              // Check left boundary (after potential flip or if initially too far left)
              if (xPosition < scrollX + safetyMargin) {
                xPosition = scrollX + safetyMargin;
              }

              // Check bottom boundary
              if (
                yPosition + tooltipHeight + safetyMargin >
                viewportHeight + scrollY
              ) {
                yPosition = event.pageY - tooltipHeight - Math.abs(offsetY); // Flip above cursor (use absolute offsetY)
                // If Math.abs(offsetY) was 0 or too small to clear cursor, add a bit more
                if (offsetY >= 0) yPosition -= 15; // Add extra space if it was meant to be below cursor
              }
              // Check top boundary (after potential flip or if initially too high)
              if (yPosition < scrollY + safetyMargin) {
                yPosition = scrollY + safetyMargin;
              }

              tooltipDiv
                .style("left", xPosition + "px")
                .style("top", yPosition + "px");
            })
            .on("mouseout.tooltip", function () {
              tooltipDiv.style("opacity", 0);
            });

          // If your existing mouseover/mouseout for flower opacity needs to coexist:
          // You might need to combine them or ensure they don't conflict.
          // The .tooltip namespace helps to separate these event handlers.
          // Your existing opacity change:
          // flowers.on("mouseover", function () {
          //   d3.selectAll(".flower").transition().duration(200).style("opacity", 0.25);
          //   d3.select(this).transition().duration(200).style("opacity", 1);
          // });
          // flowers.on("mouseout", function () {
          //   d3.selectAll(".flower").transition().duration(200).style("opacity", 1);
          // });
          // These can remain as they are, or you can integrate the opacity logic into the .tooltip handlers
          // if you want more complex interactions (e.g., only dim others if tooltip is active).
          // For now, having them separate with namespaces should be fine.
        } else {
          console.error(
            "Tooltip Error: 'flowers' selection not found or not a D3 selection."
          );
        }
        // ---> END: TOOLTIP JAVASCRIPT CODE <---
      }
    </script>
  </body>
</html>
